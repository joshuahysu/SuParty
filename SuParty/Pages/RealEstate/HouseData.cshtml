@page
@model SuParty.Pages.RealEstate.HouseDataModel
@using Microsoft.Extensions.Localization
@using System.Security.Claims

@{
    Layout = "_Layout";
}
@inject IStringLocalizer<SuParty.Pages.RealEstate.HouseDataModel> Localizer
<link rel="stylesheet" href="/css/RealEstate./HouseData.css" />
<div class="container mt-4">
    <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            @for (int i = 0; i < Model.HouseData.Images.Count; i++)
            {
                <div class="carousel-item @(i == 0 ? "active" : "")">
                    <img src="@Model.HouseData.Images[i]" class="d-block w-100" alt="Slide @(i + 1)" style="max-height: 500px; object-fit: cover;">
                </div>
            }
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <p style="margin: 0;">賣方姓名：@Model.SaleUser?.Name</p>
        <button onclick="copyModifiedUrl()">複製分享網址</button>
       

        <p>電話：@Model.SaleUser?.Phone</p>
        <p>Line：</p> <a href="@Model.SaleUser?.Line_Url" target="_blank" rel="noopener noreferrer">
            <img src="data:image/png;base64,@Model.Base64QRCode" alt="QR Code" style="width: 90px; height: auto;" />
            連結
        </a>

    </div>
 
    @if (User.Identity.IsAuthenticated && User.FindFirstValue(ClaimTypes.NameIdentifier) == Model.SaleUser.Id)
    {
        <a href="./HouseDataEdit?id=@Model.HouseData.Id">編輯</a>
    }  

    <div class="row">
        <div class="col-md-6 mb-3">     
            <div class="house-detail">
                <h1>@Model.HouseData.Name</h1> <!-- 顯示房屋名稱 -->
                <p>@Model.HouseData.Introduction</p> <!-- 顯示房屋介紹 -->
                <p>價格：$@Model.HouseData.Price</p> <!-- 顯示價格 -->
            </div>

            <div class="house-info">
                <video controls>
                    <source src="@Model.HouseData.VideoUrl" type="video/mp4">
                    Your browser does not support the video tag.
                </video> <!-- 顯示影片 -->
                <p>
                <p>📍 地址：
                    <a href="https://www.google.com/maps/search/@Model.HouseData.Address" target="_blank">
                        @Model.HouseData.Address
                    </a>
                </p> <!-- 顯示地址 -->
               </div>
           

            <div class="house-info">
                <p>🏠 房型：@Model.HouseData.ProductType</p>
                <p>🌆 城市：@Model.HouseData.City</p>
                <p>📏 空間：@Model.HouseData.Space 坪</p>
                <p>💰 每坪價格：@Model.HouseData.PricePerPing</p>
                <p>🛏️ 房間數：@Model.HouseData.RoomCount</p>
                <p>🛁 衛浴數：@Model.HouseData.RestroomCount</p>
                <p>🛋️ 客廳數：@Model.HouseData.LivingRoomCount</p>
                <p>🚗 停車位數：@Model.HouseData.ParkingSpaceCount</p>
                <p>🅿️ 停車位：@Model.HouseData.ParkingSpace</p>
                <p>🏢 樓層：@Model.HouseData.Floor</p>
            </div>

            <button id="TraceRealEstates">降價通知</button>

        </div>
    </div>
</div>

<script>    
    document.getElementById('TraceRealEstates').addEventListener('click', function () {
        AddShoppingCart(false);
    });

    function AddShoppingCart(redirect) {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id'); // 讀取 'Id' 的值
        sendRequest(_baseUrlAddAction('TraceRealEstates'), { id: id })
            .then(data => {
            if (data.success) {
                if (redirect) {
                    // 跳轉到指定頁面
                       // window.location.href = "../Shop/ShoppingCart";
                }
            } else {
                alert(data.message); // 顯示錯誤信息
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function copyModifiedUrl() {
      const url = new URL(window.location.href);
      url.searchParams.set("promoter", "@Model.UserID"); // 加上或更新參數
      navigator.clipboard.writeText(url.toString())
        .then(() => alert("已複製分享網址"))
        .catch(err => {
          console.error("複製失敗：", err);
          alert("複製失敗，請查看 console");
        });
    }

</script>